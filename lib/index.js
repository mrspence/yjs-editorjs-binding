(()=>{"use strict";var e={999:(e,r)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var t=[];for(var i=0;i<256;++i){t[i]=(i+256).toString(16).substr(1)}function bytesToUuid(e,r){var i=r||0;var n=t;return[n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]]].join("")}var n=bytesToUuid;r["default"]=n},741:(e,r,t)=>{var i;i={value:true};Object.defineProperty(r,"v1",{enumerable:true,get:function(){return n.default}});Object.defineProperty(r,"v3",{enumerable:true,get:function(){return u.default}});Object.defineProperty(r,"v4",{enumerable:true,get:function(){return a.default}});Object.defineProperty(r,"v5",{enumerable:true,get:function(){return o.default}});var n=_interopRequireDefault(t(734));var u=_interopRequireDefault(t(84));var a=_interopRequireDefault(t(844));var o=_interopRequireDefault(t(97));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}},970:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(113));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function md5(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return i.default.createHash("md5").update(e).digest()}var n=md5;r["default"]=n},573:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=rng;var i=_interopRequireDefault(t(113));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function rng(){return i.default.randomBytes(16)}},801:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(113));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function sha1(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return i.default.createHash("sha1").update(e).digest()}var n=sha1;r["default"]=n},734:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(573));var n=_interopRequireDefault(t(999));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var u;var a;var o=0;var d=0;function v1(e,r,t){var l=r&&t||0;var f=r||[];e=e||{};var s=e.node||u;var c=e.clockseq!==undefined?e.clockseq:a;if(s==null||c==null){var _=e.random||(e.rng||i.default)();if(s==null){s=u=[_[0]|1,_[1],_[2],_[3],_[4],_[5]]}if(c==null){c=a=(_[6]<<8|_[7])&16383}}var v=e.msecs!==undefined?e.msecs:(new Date).getTime();var y=e.nsecs!==undefined?e.nsecs:d+1;var p=v-o+(y-d)/1e4;if(p<0&&e.clockseq===undefined){c=c+1&16383}if((p<0||v>o)&&e.nsecs===undefined){y=0}if(y>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}o=v;d=y;a=c;v+=122192928e5;var b=((v&268435455)*1e4+y)%4294967296;f[l++]=b>>>24&255;f[l++]=b>>>16&255;f[l++]=b>>>8&255;f[l++]=b&255;var h=v/4294967296*1e4&268435455;f[l++]=h>>>8&255;f[l++]=h&255;f[l++]=h>>>24&15|16;f[l++]=h>>>16&255;f[l++]=c>>>8|128;f[l++]=c&255;for(var g=0;g<6;++g){f[l+g]=s[g]}return r?r:(0,n.default)(f)}var l=v1;r["default"]=l},84:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(473));var n=_interopRequireDefault(t(970));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const u=(0,i.default)("v3",48,n.default);var a=u;r["default"]=a},473:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=_default;r.URL=r.DNS=void 0;var i=_interopRequireDefault(t(999));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function uuidToBytes(e){var r=[];e.replace(/[a-fA-F0-9]{2}/g,(function(e){r.push(parseInt(e,16))}));return r}function stringToBytes(e){e=unescape(encodeURIComponent(e));var r=new Array(e.length);for(var t=0;t<e.length;t++){r[t]=e.charCodeAt(t)}return r}const n="6ba7b810-9dad-11d1-80b4-00c04fd430c8";r.DNS=n;const u="6ba7b811-9dad-11d1-80b4-00c04fd430c8";r.URL=u;function _default(e,r,t){var generateUUID=function(e,n,u,a){var o=u&&a||0;if(typeof e=="string")e=stringToBytes(e);if(typeof n=="string")n=uuidToBytes(n);if(!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||n.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var d=t(n.concat(e));d[6]=d[6]&15|r;d[8]=d[8]&63|128;if(u){for(var l=0;l<16;++l){u[o+l]=d[l]}}return u||(0,i.default)(d)};try{generateUUID.name=e}catch(e){}generateUUID.DNS=n;generateUUID.URL=u;return generateUUID}},844:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(573));var n=_interopRequireDefault(t(999));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function v4(e,r,t){var u=r&&t||0;if(typeof e=="string"){r=e==="binary"?new Array(16):null;e=null}e=e||{};var a=e.random||(e.rng||i.default)();a[6]=a[6]&15|64;a[8]=a[8]&63|128;if(r){for(var o=0;o<16;++o){r[u+o]=a[o]}}return r||(0,n.default)(a)}var u=v4;r["default"]=u},97:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:true});r["default"]=void 0;var i=_interopRequireDefault(t(473));var n=_interopRequireDefault(t(801));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const u=(0,i.default)("v5",80,n.default);var a=u;r["default"]=a},113:e=>{e.exports=require("crypto")}};var r={};function __nccwpck_require__(t){var i=r[t];if(i!==undefined){return i.exports}var n=r[t]={exports:{}};var u=true;try{e[t](n,n.exports,__nccwpck_require__);u=false}finally{if(u)delete r[t]}return n.exports}(()=>{__nccwpck_require__.d=(e,r)=>{for(var t in r){if(__nccwpck_require__.o(r,t)&&!__nccwpck_require__.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r[t]})}}}})();(()=>{__nccwpck_require__.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r)})();(()=>{__nccwpck_require__.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t={};(()=>{__nccwpck_require__.r(t);__nccwpck_require__.d(t,{YDocEditorJSBinding:()=>YDocEditorJSBinding});const createMutex=()=>{let e=true;return(r,t)=>{if(e){e=false;try{r()}finally{e=true}}else if(t!==undefined){t()}}};var e=__nccwpck_require__(741);const r=e.v1;const i=e.v3;const n=e.v4;const u=e.v5;var a=undefined&&undefined.__awaiter||function(e,r,t,i){function adopt(e){return e instanceof t?e:new t((function(r){r(e)}))}return new(t||(t=Promise))((function(t,n){function fulfilled(e){try{step(i.next(e))}catch(e){n(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){n(e)}}function step(e){e.done?t(e.value):adopt(e.value).then(fulfilled,rejected)}step((i=i.apply(e,r||[])).next())}))};class YDocEditorJSBinding{constructor(e){this.internalStore=new Map;this.ydocArray=e;this.mutex=createMutex();this.isReady=false}initialize(e){return a(this,void 0,void 0,(function*(){this.editor=e;yield this.editor.isReady;this.initialRenderYdocToEditorJS();this.deeplyObserveYdocArray();this.isReady=true}))}onBlockEventEditorJS(e,r){var t;return a(this,void 0,void 0,(function*(){if(this.isReady===false)return;const e=r.detail.index;const i=((t=this.internalStoreAsArray.find((r=>r.index===e)))===null||t===void 0?void 0:t.editorBlock.uuid)||n();const u=(yield r.detail.target.save())||{};u.uuid=i;r.detail.target.holder.setAttribute("data-y2-uuid",i);this.mutex((()=>{switch(r.type){case"block-added":if(this.internalStore.has(i))break;this.ydocArray.insert(e,[u]);this.internalStore.set(i,{index:e,editorBlock:u});break;case"block-removed":if(!this.internalStore.has(i))break;const r=this.ydocArray.toArray().findIndex((e=>e.uuid===i));this.ydocArray.delete(r);this.internalStore.delete(i);break;case"block-changed":if(this.internalStore.has(i)){this.ydocArray.delete(e)}this.ydocArray.insert(e,[u]);this.internalStore.set(i,{index:e,editorBlock:u});break}}))}))}get internalStoreAsArray(){return Array.from(this.internalStore.values())}initialRenderYdocToEditorJS(){if(this.ydocArray.length===0){return}this.ydocArray.toArray().forEach(((e,r)=>this.renderBlock(e,r)))}deeplyObserveYdocArray(){this.ydocArray.observeDeep(((e,r)=>{this.mutex((()=>{for(const r of e){let e=0;for(const t of r.changes.delta){for(const[r,i]of Object.entries(t)){switch(r){case"retain":e+=i;continue;case"insert":for(const r of i){this.internalStore.set(r.uuid,{index:e,editorBlock:r});this.renderBlock(r,e);e++}continue;case"delete":for(let r=e;r<e+i;r++){const e=this.editor.blocks.getBlockByIndex(r);const t=(e===null||e===void 0?void 0:e.holder.getAttribute("data-y2-uuid"))||null;if(t===null)continue;this.editor.blocks.delete(r);this.internalStore.delete(t)}e+=i;continue}}}}}))}))}renderBlock(e,r){this.editor.blocks.insert(e.type,e.data,null,r,false);const t=this.editor.blocks.getBlockByIndex(r);t.holder.setAttribute("data-y2-uuid",e.uuid);this.internalStore.set(e.uuid,{index:r,blockApi:t,editorBlock:e})}}})();module.exports=t})();